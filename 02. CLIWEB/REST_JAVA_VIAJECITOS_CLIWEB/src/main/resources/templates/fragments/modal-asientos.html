<!-- fragments/modalAsientos.html -->
<div th:fragment="modalAsientos">
    <div class="modal fade" id="modalAsientos" tabindex="-1" aria-hidden="true" aria-labelledby="modalAsientosLabel">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title" id="modalAsientosLabel">Seleccionar Asientos (Vuelo [[${vueloId}]])</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>

                <div class="modal-body">
                    <!-- Contador -->
                    <div id="contadorFlotante" class="mb-2">
                        Seleccionados: <span id="contadorSeleccion">0</span>
                        <button type="button" class="btn btn-sm btn-light ms-2" onclick="limpiarSeleccion()">Limpiar</button>
                    </div>

                    <!-- Formulario -->
                    <form method="post" th:action="@{/seleccionar-asientos}" id="formAsientos">
                        <input type="hidden" name="vueloId" th:value="${vueloId}" />
                        <input type="hidden" name="clientePorAsientoJson" id="clientePorAsientoJson" />

                        <!-- Mapa de asientos -->
                        <div class="bus mt-4">
                            <div th:each="fila : ${rows}" class="fila mb-2">
                                <div th:each="col : ${cols}" style="margin-right: 4px;"
                                     th:with="asiento=${asientoMap[fila.toString()][col.toString()]}">

                                    <input type="checkbox"
                                           th:id="${'asi-' + fila + '-' + col}"
                                           name="asientos"
                                           th:value="${asiento != null ? asiento.asientoId : ''}"
                                           th:data-asiento-id="${asiento != null ? asiento.asientoId : ''}"
                                           th:disabled="${asiento == null or asiento.estado != 'DISPONIBLE'}" />

                                    <label th:for="${'asi-' + fila + '-' + col}"
                                           class="asiento"
                                           th:classappend="(
                                               ${asiento != null and asiento.estado=='DISPONIBLE'} ? ' disponible' :
                                               (${asiento != null and asiento.estado=='RESERVADO'} ? ' reservado' :
                                               (${asiento != null and asiento.estado=='PAGADO'} ? ' pagado' : ''))
                                           )">
                                        <span th:text="${fila + col}">A1</span>
                                    </label>

                                    <!-- Selector de cliente (oculto inicialmente) -->
                                    <div class="form-cliente mt-1" style="display: none;"
                                         th:id="'form-cliente-' + ${asiento.asientoId}">
                                        <select class="form-select form-select-sm seleccionar-cliente"
                                                th:id="'select-cliente-' + ${asiento.asientoId}"
                                                th:data-asiento-id="${asiento.asientoId}">
                                            <option value="">Seleccionar cliente</option>
                                            <option th:each="c : ${clientesReferidos}"
                                                    th:value="${c.clienteId}"
                                                    th:text="${c.clienteNombre + ' - ' + c.clienteCedula}">
                                            </option>
                                        </select>

                                        <!-- BotÃ³n para crear nuevo cliente -->
                                        <button type="button"
                                                class="btn btn-sm btn-outline-success mt-1 agregar-cliente"
                                                th:attr="onclick=|abrirModalNuevoCliente(${asiento.asientoId})|">
                                            + Crear nuevo cliente
                                        </button>
                                    </div>
                                </div>

                                <!-- Pasillo -->
                                <span th:if="${col == 'C'}" style="display:inline-block;width:20px;"></span>
                            </div>
                        </div>

                        <!-- Botones -->
                        <div class="modal-footer">
                            <button type="submit" name="accion" value="seguir" class="btn btn-success">Seguir comprando</button>
                            <button type="submit" name="accion" value="pagar" class="btn btn-primary">Ir a pagar</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>
